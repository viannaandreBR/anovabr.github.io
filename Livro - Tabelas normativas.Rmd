---
title: "Livro - Tabelas normativas"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(knitr)
library(stargazer)
library(ggplot2)
library(gridExtra)
```

## Tabelas normativas

Frequentemente, os pesquisadores t?m o interesse de verificar o quanto um conjunto de vari?veis pode explicar um determinado fen?meno. Esta iniciativa ? feita para confeccionar as normas (iniciais) de um teste psicol?gico que, por sua vez, s?o fundamentais para posicionar os respondentes dentro de um continuum que o instrumento se prop?e a medir. Evidentemente, para a constru??o de normas v?lidas, ? preciso que a amostra avaliada seja representativa da popula??o a quem o teste se refere.

Para exemplificar esta situa??o na ?rea da Neuropsicologia cl?nica, imaginemos a situa??o do *Trail Making Test*. Est? ? uma atividade frequentemente utilizada em Neuropsicologia cl?nica e, em uma de suas etapas, os participantes devem ligar n?meros a letras de forma sucessiva, o mais r?pido poss?vel, sem retirar o l?pis do papel e sem cruzar as linhas.O tempo de resposta ? medido em segundos e revela a performance do participante. Imaginemos que este teste foi aplicado a uma amostra representativa de 100 participantes e que agora queremos construir uma tabela normativa considerando as vari?veis significativas na explica??o da performance das pessoas.

Este modelo descrito pode ser apresentado a partir de uma regress?o m?ltipla, onde o tempo de rea??o (y, vari?vel dependente/prevista deste teste) pode ser explicado a partir de diversas vari?veis independentes/preditoras dos participantes (x). Algebricamente:

$$
\hat{Y}_i = \hat{\beta}_0 + {\sum_{i=1}^n} \beta_iX_{ij}+ \hat{\epsilon}_i 
$$
Onde:

$\hat{Y}_i$ ? o Valor previsto para o sujeito i

$\hat{Y}_i$ ? o Intercepto e representa o valor de $\hat{Y}_i$ quando x ? igual a 0

$\hat\beta_1$ ? a Inclina??o parcial

$\hat\epsilon_1$ Diferen?a do valor previsto $\hat{Y}_i$ e o valor atual de $Y_i$

*Nota: ? importante mencionar que como estamos trabalhando com pesquisas estat?sticas (em que n?o temos acesso ? toda popula??o), os s?mbolos ganham um "chap?u" para indicar que s?o estimativas.*
 
Dada esta confec??o incial, agora ? preciso saber quais s?o as vari?veis preditoras que devem ser mantidas nas normas e quais devem ser retiradas. Para que este processo seja capaz de gerar um modelo parcimonioso, ou seja, que combine a melhor capacidade explicativa com o menor conjunto de vari?veis, ser? necess?rio combinar a teoria psicol?gica com a aplica??o de testes de hip?teses. A teoria servir? para imputar as vari?veis iniciais do modelo e o teste de hip?teses ser? utilizado para confirmar (ou n?o) a signific?ncia da vari?vel.

Assim sendo, a revis?o da literatura sobre este teste indica que "escolaridade" e a "idade" s?o preditores significativos para "performance", mas ainda n?o h? consenso em rela??o ao "sexo" do participante. Desta maneira, podemos criar um primeiro modelo em que todas as potenciais vari?veis explicativas estejam inclu?das e, dada esta condi??o, cham?-lo chamado de "irrestrito". Algebricamente, ele pode ser escrito assim:

$$ 
\hat{Performance}_i = \hat{\beta}_0 + \hat\beta_1Escolaridade + \hat\beta_2Idade  + \hat\beta_3Sexo  + \hat{\epsilon}_i 
$$

Em seguida, estimar este modelo com os dados coletados e verificar se todos os pressupostos desta t?cnica foram alcan?ados. A tabela 1 descreve os resultados obtidos utiizando dados simulados e, por finalidade acad?mica, consideraremos os pressupostos cumpridos. 

```{r echo=FALSE,results='show',message=FALSE, eval=TRUE}
set.seed(123)
tmt <- data.frame(sexo=c(0,1), 
                  escolaridade=rnorm(100, 12, 6),
                  idade=rnorm(100, 50, 10))
tmt$tempo <-ifelse(tmt$idade > 50 & tmt$escolaridade < 12, rnorm(100, 55, 4), rnorm(100, 45, 4))
MR1 <- lm(tempo ~ escolaridade + idade + sexo, data = tmt)
MR2 <- lm(tempo ~ escolaridade + idade, data = tmt)
FMOD <- anova(MR1,MR2)
#kable(summary(MR1)$coef, digits=2)
#texreg(list(MR1))
#```{r mylatextable, results = "asis"}
#stargazer(MR1, type = 'html')
```

```{r word_table, comment = '', echo=FALSE}
stargazer(MR1, type = 'text',
          title = "Tabela 1. Coeficientes do modelo de regress?o m?ltipla (Modelo irrestrito)", single.row=TRUE, ci=TRUE, ci.level=0.9, intercept.top=TRUE, intercept.bottom=FALSE)

```

Pelo menos quatro conclus?es podem ser obtidas desta tabela. 

* A primeira ? relacionada com a Estat?stica F, que compara a capacidade explicativa deste modelo com o modelo que considera apenas a m?dia. Neste sentido, este modelo ? 25,6 vezes superior. 

* A segunda ? a an?lise e interpreta??o do Coeficiente de Determina??o (R2), que mostra o quanto da variabilidade da "performance" pode ser atribu?do ?s vari?veis do modelo. Assim, este modelo explica 44.5% da variabilidade da "performance." 

* A terceira recai sobre o Coeficiente de Determina??o ajustado (R2 ajustado), que corrige o Coeficiente de Determina??o considerando a complexidade do modelo.

* A quarta ? a interpreta??o das vari?veis significativas, que foram aquelas com valor de p inferior ? signific?ncia previamente definida, normalmente 0,05.

Neste exemplo, vemos que tanto a "escolaridade", medida em anos de estudo, quanto a "idade" s?o vari?veis significativas. Desta maneira, podemos interpretar tais resultados da seguinte forma: em **m?dia**, 

* Cada ano a mais de "escolaridade" ocasiona uma redu??o de 1.116 segundo(s) na "performance", mantendo as demais vari?veis constantes. 

* Cada ano de "idade" a mais, mantendo as outras vari?veis constantes, ocasiona o aumento do tempo da "performance" em 0.623.

Apesar do intercepto ser significativo, ele n?o tem interpreta??o neste exemplo. Isto ocorre, pois o intercepto apresenta o valor de Y quando as vari?veis X s?o iguais a 0, o que n?o ? poss?vel para estes dados. No entanto, pela an?lise da diferen?a entre o R2 e o R2 ajustado e pela vari?vel "sexo" n?o ter sido significativa, podemos supor que haja vari?veis excessivas no modelo. Isto ocorre pois cada nova vari?vel adicionada a um modelo de regress?o, esp?ria ou n?o, gera aumento do R2. Assim, o R2 ajustado ? uma estat?stica mais confi?vel, j? que aplica corre??es ? complexidade do modelo. Seu c?lculo se apresenta assim:

$$
R_{ajd}^2 = 1-\frac{SQR/(n-k-1)}{SQT/(n-1)}
$$


Onde:
SQR = Soma do quadrado dos res?duos
n = Total de participantes
k = Total de preditores do modelo (Lembre-se que este modelo tem 3 preditores e concorre com o modelo que usa apenas a m?dia.)
SQR = Soma do quadrado total


```{r echo=FALSE}
#reressao na mao
#(sqt <-sum((tmt$tempo-mean(tmt$tempo))^2)) #soma do quadrado total
#(sqrfull <- sum(residuals(MR1)^2))
#(sqe <- sum((predict(MR1)-mean(tmt$tempo))^2))
#sqe/sqt # raz?o soma do quadrado explicada por soma do quadrado total
#1-(sqrfull/sqt) #raz?o soma do quadrado do res?duo por soma do quadrado total
#1-(sqrfull/(nrow(tmt)-(MR1$rank-1)-1))/(sqt/(nrow(tmt)-1)) #r2 ajustado (pune por preditores)

```

Diante da situa??o combinada da diferen?a entre o R2  e o R2ajustado e da vari?vel "sexo" n?o ter sido significativa, torna-se importante construir um modelo restrito, em que apenas as vari?veis significativas estejam presentes. Assim, se este modelo n?o for significativamente diferente do modelo irrestrito, teremos um alcan?ado a parcim?nia que queremos. Desta vez, o modelos ser?: 

$$ 
\hat{Performance}_i = \hat{\beta}_0 + \beta_1Escolaridade + \beta_2Idade  + \hat{\epsilon}_i 
$$

Que gera os seguintes resultados: 

```{r comment = '', echo=FALSE}
stargazer(MR2, type = 'text',
          title = "Tabela 2. Coeficientes do modelo de regress?o m?ltipla (Modelo restrito)", single.row=TRUE, ci=TRUE, ci.level=0.9, intercept.top=TRUE, intercept.bottom=FALSE)
```
Para facilitar a visualiza??o, a tabela 3 apresenta ambos os modelos lado a lado.

```{r comment = "", echo=FALSE}
stargazer(MR1, MR2, type = 'text',
          title = "Tabela 2. Coeficientes do modelo de regress?o m?ltipla (Modelo restrito)", ci=TRUE, ci.level=0.9, intercept.top=TRUE, intercept.bottom=FALSE)
```
Podemos verificar que, apesar do R2 ter diminu?do, o R2 ajustado aumentou. Al?m disso, o erro padr?o do res?duo foi tamb?m menor no modelo restrito, o que aponta para superioridade deste ?ltimo. Por?m, para evitar erros de julgamento baseado em compara??es visuais e aleat?rias, ? necess?rio comparar ambos os modelos por um teste de hip?teses. Este teste ir? verificar se a influ?ncia de ter restrito o B2Sexo para 0 ? significativa ou n?o. Desta maneira, temos:


$H_0$ : $\beta_3=0$

$H_1$ : $\beta_3\neq0$


Este teste ? uma An?lise da Vari?ncia entre ambos os modelos e pode pode ser escrita da seguinte forma:

$$
F = \frac{SQR(Restrito)-SQR(Irrestrito)/q}{SQR(Irrestrito)/(n-k-1)}\text{~}F_{q,n-k-1}
$$

Os resultados est?o expressos na tabela:

```{r comment = '', echo=FALSE}
stargazer(FMOD, type = 'text',
          title = "Tabela 3. Compara??o entre Modelos", report=('vc*p'))
f_modelo <- round(FMOD$`Pr(>F)`[2],2)
MR2_intercept <- round(coefficients(MR2)[["(Intercept)"]],2)
MR2_escolaridade <- round(coefficients(MR2)[["escolaridade"]],2)
MR2_idade <- round(coefficients(MR2)[["idade"]],2)

#(sqr0 <-sum((tmt$tempo-mean(tmt$tempo))^2)) #caso eu queira comparar com a m?dia
#(sqrfull <- sum(residuals(MR1)^2))
#(a <- (sqrfull - sqr0)/3)  # numerador SQR(i)-SQR(r)/q 
#(b <- sqrfull/(nrow(tmt)-3-1)) #denominador SQR(I)/n-k-1
#(a/b)

#anova na m?o #modelo irrestrito vs modelo restrito
#c <- sum((residuals(MR2)^2))-sum((residuals(MR1)^2))/(MR1$rank-MR2$rank) #divido #por 1 pois tenho somente 1 restri??o
#d <- sum((residuals(MR1)^2))/(nrow(tmt)-MR2$rank-1)
#c/d
```

O valor de p foi de `r f_modelo` que ? superior ao estipulado para signific?ncia (0,05) e, portanto, n?o se rejeita a Hip?tese nula de que $\beta_3$ pode ser restrito a 0. A interpreta??o ? simples: apesar de termos "retirado" uma vari?vel, este modelo n?o perdeu capacidade explicativa. Muito pelo contr?rio, a aus?ncia de uma vari?vel n?o significativa incrementou a parcimonia do modelo. Desta maneira, a conclus?o ? que a tabela normativa deve ser composta pelo modelo mais simples, formado pelo **intercepto**, **idade** e **escolaridade** do participante, em que os coeficientes sejam: `r MR2_intercept` para o intercepto, `r MR2_escolaridade` para escolaridade e `r MR2_idade` para idade.

? poss?vel apresentar a rela??o entre as vari?veis a partir de um plano gr?fico, tal como exemplificado abaixo. Optamos por apresentar gr?ficos separados para facilitar a visualiza??o de cada vari?vel independentemente.

```{r webGL = TRUE, echo=FALSE}
plot_escolaridade <- ggplot(data = tmt, aes(x = escolaridade, y = tempo)) + 
geom_point() + 
stat_smooth(method = "lm") + 
scale_y_continuous(expand = c(0.01, 0)) + 
xlab("Escolaridade") + 
ylab("Tempo (Performance)") + 
theme_bw(base_size = 14, base_family = "sans")
plot_idade <- ggplot(data = tmt, aes(x = idade, y = tempo)) + 
geom_point() + 
stat_smooth(method = "lm") + 
scale_y_continuous(expand = c(0.01, 0)) + 
xlab("Idade") + 
ylab("Tempo (Performance)") + 
theme_bw(base_size = 14, base_family = "sans")

plots <- grid.arrange(plot_escolaridade, plot_idade, ncol=3)
```

# Tabelas baseadas em Regress?o m?ltipla

Todas estas an?lises n?o s?o novas para os psicometristas. Testes de hip?teses e compara??o entre modelos restritos e irrestritos fazem parte de aspectos b?sicos de estat?stica que, normalmente, s?o ensinados em bons cursos de gradua??o e p?s-gradua??o. Por?m, a forma de apresenta??o e intera??o da proposta de tabelas normativas baseadas em regress?o ? bastante inovadora na ?rea. Em vez de termos diversas tabelas em que se conside apenas uma ?nica vari?vel, agora podemos equacionar todas as vari?veis de uma ?nica vez. 

Em termos pr?ticos, o que temos hoje s?o livros com tabelas normativas impressas em que, quase que de forma descuidada, o cl?nico seleciona a vari?vel que acredita ser a mais importante. No exemplo citado, ele poderia comparar a "performance" de uma pessoa de 40 anos de "idade" e 12 de "escolaridade" tanto com as normas impressas na tabela de faixa et?ria (por exemplo, de pessoas entre 30 e 40), tanto com as normas da tabela de faixa de escolaridade (por exemplo, pessoas com ensino superior). Frequentemente,isto pode gerar resultados discrepantes, em que uma tabela considera a "performance" do participante abaixo do esperado, enquanto a outra considera adequada.

De fato, a sa?da desta armadilha vem pelo c?lculo do valor previsto de um participante a partir dos coeficientes gerados pela regress?o. Neste caso, temos os seguintes 
coeficientes como preditores da performance:


```{r echo=FALSE,results='show',message=FALSE, eval=TRUE}
coef(MR2)
```

que devem ser multiplicados tal como o exemplo abaixo:

Assim, o valor esperado para uma pessoa com 65 anos de idade e 12 de escolaridade ? de **`r round(MR2_intercept + MR2_idade*65 + MR2_escolaridade*12,1)`** segundos. Caso ele tivesse apenas 5 anos de escolaridade, o valor esperado seria de **`r MR2_intercept + MR2_idade*65 + MR2_escolaridade*5`**. De posse de tais informa??es, o cl?nico poder? tomar uma decis?o que seja adequada a seu caso.


? importante, no entanto, atentar que os valores previstos misturam informa??es v?lidas e uma quantidade de ru?do. Isto ocorre pois ? necess?rio computar tamb?m a quantidade de erro de cada estimativa no resultado, o que ser? futuramente poss?vel em novos projetos que est?o sendo j? desenvolvidos. No entanto, os exemplos aqui ilustrados visam introduzir o tema e n?o esgot?-lo. 

Posto isto, as tabelas constru?das com base em modelos de regress?o s?o mais informativas do que as que majoritariamente s?o utilizadas atualmente, j? que permitem n?o somente a conjuga??o de m?ltiplas vari?veis, mas equacion?-las de forma a estimar a parcela de contribui??o que cada uma delas apresenta sobre o fen?meno de interesse.
